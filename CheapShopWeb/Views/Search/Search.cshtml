@using CheapShopWeb.Models
@using Microsoft.Ajax.Utilities
@model IEnumerable<CheapShopWeb.Models.Product>
@{
    ViewBag.Title = "Search";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div>
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8">
            <form>
                <div class="card-body row no-gutters align-items-center">
                    <div class="col-auto">
                        <i class="h4 text-body"></i>
                    </div>
                    <!--end of col-->
                    <div class="col">
                        <input class="form-control form-control-lg" type="search" name="search" placeholder="@Request.Params["search"]">
                    </div>
                    <!--end of col-->
                    <div class="col-auto">
                        <button class="btn btn-lg btn-success" type="submit">Search</button>
                    </div>
                    <!--end of col-->
                </div>
            </form>
        </div>
        <!--end of col-->
    </div>

</div>

@if(Model.Count() > 0 && !string.IsNullOrWhiteSpace(@Request.Params["search"]))
{
    <div class="row">
        <div class="col-sm-4 col-md-3 col-lg-2">
            <form id="form1" class="form1"> @*border border-dark*@

                <div class="form-group">
                    <label for="priceFrom">Min price</label>
                    <input step=".01"min="0" type="number"onchange="(function(el){el.value=parseFloat(el.value).toFixed(2);})(this)" class="form-control" id="priceFrom" name="priceFrom" placeholder="@Request.Params["priceFrom"]">
                </div>
                <div class="form-group">
                    <label for="priceTo">Max price</label>
                    <input step=".01"min="0" type="number"onchange="(function(el){el.value=parseFloat(el.value).toFixed(2);})(this)" class="form-control" id="priceTo" name="priceTo" placeholder="@Request.Params["priceTo"]">
                </div>
                <p>Sources:</p>
                <div class="form-group form-check" name="source">
                    <input type="checkbox" class="form-check-input" id="Rde" name="source" value="Rde">Rde<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Bigbox" value="Bigbox">Bigbox<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Pigu" value="Pigu">Pigu<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Senukai" value="Senukai">Senukai<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Autoaibe" value="Autoaibe">Autoaibe<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Topocentras" value="Topocentras">Topocentras<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Ermitazas" value="Ermitazas">Ermitazas<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Skytech" value="Skytech">Skytech<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Varle" value="Varle">Varle<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Eoltas" value="Eoltas">Eoltas<br />
                    <input type="checkbox" class="form-check-input" name="source" id="Novastar" value="Novastar">Novastar<br />
                </div>
                <p>Groups:</p>
                <div class="form-group form-check" name="group">
                    <input type="checkbox" class="form-check-input" name="group" id="Computer" value="Computer">Computer<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Phone" value="Phone">Phone<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Garden" value="Garden">Garden<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Leisure" value="Leisure">Leisure<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Books" value="Books">Books<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Car" value="Car">Car<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Stationery" value="Stationery">Stationery<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Animals" value="Animals">Animals<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Camera" value="Camera">Camera<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Audio" value="Audio">Audio<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Beauty" value="Beauty">Beauty<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Household" value="Household">Household<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Furniture" value="Furniture">Furniture<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Clothing" value="Clothing">Clothing<br />
                    <input type="checkbox" class="form-check-input" name="group" id="Kids" value="Kids">Kids<br />
                </div>
                <button type="submit">Filter</button>
            </form>
        </div>
        <div class="col-sm-8 col-md-9 col-lg-10">
            @if (Model != null)
            {
                foreach (var item in Model)
                {
                    <div class="container-fluid border border-dark mb-4">
                        <div class="row">
                            <div class="col-sm-12 col-md-3">
                                <img class="img-fluid mx-auto d-block" src=@item.photo_link alt="" />
                            </div>
                            <div class="col-sm-12 col-md-6 border border-primary">
                                <h2>@item.name</h2>
                                <p>Grupė: @item.group</p>
                                <p>Šaltinis: @item.source</p>
                            </div>

                            <div class="col-sm-12 col-md-3">
                                <h2>@item.price</h2>
                                <a href=@item.product_link class="btn btn-primary">Link</a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                }
            }
        </div>
    </div>
}else{
<div><p class="h4">Nothing</p></div>
}

 
<style>
    .form1{
        padding: 5px;
    }

</style>
@section scripts{
    <script type="text/javascript">
        var kvp = [];
        var params = [];
        $("#form1").submit(function(e) {
            e.preventDefault();
            kvp = document.location.search.substr(1).split('&');
            var sources = [];
            $("input:checkbox[name=source]:checked").each(function () {
                
                sources.push($(this).val());
                //$(this).prop("checked", false);
            });
            
            var group = [];
            $("input:checkbox[name=group]:checked").each(function () {
                
                group.push($(this).val());
                //$(this).prop("checked", false);
            });
            

            addParameter("source", sources);
            addParameter("group", group);

            var fromprice = document.getElementById("priceFrom").value;
            addParameter("priceFrom", fromprice);

            var toprice = document.getElementById("priceTo").value;
            addParameter("priceTo", toprice);
          
            params = kvp.join('&');
            console.log(params);
            document.location.search = params;
        });

        function addParameter(k, v) {
            if (v.length > 0) {
                var key = encodeURIComponent(k);
                var value = encodeURIComponent(v);
                var i = 0;
                for (; i < kvp.length; i++) {
                    if (kvp[i].startsWith(key + '=')) {
                        var pair = kvp[i].split('=');
                        pair[1] = value;
                        kvp[i] = pair.join('=');
                        break;
                    }
                }
                if (i >= kvp.length) {
                    kvp[kvp.length] = [key, value].join('=');
                }
            }
        }
    </script>}